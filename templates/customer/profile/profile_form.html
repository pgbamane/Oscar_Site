{#{% extends 'oscar/customer/profile/profile_form.html' %}#}
{% extends "customer/baseaccountpage.html" %}
{#{% extends "layout.html" %}#}
{% load static %}
{% load crispy_forms_tags %}
{% load crispy_forms_filters %}

{% load i18n %}
{% block title %}
    {% trans 'Profile Form' %} | {{ block.super }}
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static 'oscar/js/ajax_post_request_csrf/ajax_call_csrf_token.js' %}"
            type="text/javascript">
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#form-div").on("click", "input#id-Profile-Save", function (event) {
                event.preventDefault();
                {#alert('Profile Update Clicked...');#}
                console.log('Profile Update Clicked...')
                var profileupdate_form_id = $("#id-Profile-Update-Form");
                console.log("Form Serialized: ", profileupdate_form_id.serialize());

                $.ajax({
                    url: "#",
                    type: "POST",
                    data: profileupdate_form_id.serialize(),
                    {#headers: {'X-CSRFToken': '{{ csrf_token }}'}, // for csrf token working way to send it#}
                    dataType: "json",
                    success: function (response) {
                        alert('Called View:');
                        console.log("View Response:            " + response.success);
                        var success = response['success'];
                        if (success) {
                            {#alert("Success got........")#}
                            var redirect_to = response['location'];
                            if (redirect_to) {
                                console.log("You will now be redirected." + redirect_to);
                                alert("You will now be redirected to " + redirect_to);
                                window.location.href = redirect_to;
                            }
                        } else {
                            var form_html_str = response['html'];
                            console.log("Type of response html : " + typeof (form_html_str));
                            console.log("ProfileUpdate Form Page(Obj) : " + form_html_str);

                            var form_html = $(form_html_str);
                            console.log("Form HTML(Jquery Obj) : " + form_html);
                            console.log("Form HTML(Outer Html) : " + form_html[0].outerHTML);
                            $(profileupdate_form_id).replaceWith(form_html);
                        }
                    },
                    failure: function (error) {
                        alert("Error ${error} ")
                        console.log(`Error ${error}`);
                    }
                })
            });
        });
    </script>
{% endblock scripts %}

{% block tabcontent %}
    <div class="container" style="">
        {#    margin: 49px;#}
        <div class="row">
            <div class="" id="form-div" style="background-color: #7b858a1a;
            padding: 30px 30px; border: 1px solid #286090;border-radius: 3px;">
                {% crispy form %}
                {#                {{ form|crispy }}#}
                <hr>
            </div>
        </div>
    </div>
{% endblock tabcontent %}
